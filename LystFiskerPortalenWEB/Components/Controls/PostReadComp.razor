@inject IPostRepo postRepo

@if (posts == null)
{
    <p><em>Loading...</em></p>
}
else
{
    @foreach (var post in posts)
    {
        <div class="card" style="width: 32rem; margin-bottom: 2%; position: relative;">
            <div class="card-body">

                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <a>BRUGER</a>

                    <div class="dropdown" style="position: relative;">
                        <button class="btn btn-light dropdown-toggle"
                                style="border: none;"
                                @onclick="() => ToggleDropdown(post.Id)">
                            ⋮
                        </button>

                        @if (openDropdownId == post.Id)
                        {
                            <ul class="dropdown-menu show"
                                style="display: block; right: 0; left: auto; position: absolute;">
                                <li>
                                    <a class="dropdown-item"
                                       @onclick="() => DeletePost(post.Id)">
                                        Slet opslag
                                    </a>
                                </li>
                            </ul>
                        }
                    </div>
                </div>

                <p class="card-text">@post.CreationDate</p>
                <h5 class="card-title">@post.Title</h5>
                <p class="card-text">@post.Description</p>
                <p class="card-text">@post.Location</p>
            </div>

            @if (post.Picture != null)
            {
                <img src="@post.Picture" class="card-img-top"
                     alt="Billede ikke fundet"
                     style="max-width: 100%; max-height: 80%;">
            }

            <hr />
            <a>KOMMENTARER</a>
        </div>
    }
}

@code {
    private List<Post> posts { get; set; }
    private int? openDropdownId = null;

    protected override async Task OnInitializedAsync()
    {
        posts = await postRepo.GetAllPosts();
    }

    private void ToggleDropdown(int postId)
    {
        if (openDropdownId == postId)
            openDropdownId = null;
        else
            openDropdownId = postId;
    }

    private async Task DeletePost(int postId)
    {
        await postRepo.DeletePost(postId);
        posts = await postRepo.GetAllPosts();
        openDropdownId = null;
    }
}